# Celery Worker and Broker - Production
broker:
  enabled: true
  replicaCount: 1
  image:
    repository: redis
    tag: 7.2-alpine
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: 256Mi
      cpu: 200m
    limits:
      memory: 512Mi
      cpu: 500m

worker:
  enabled: true
  replicaCount: 5
  image:
    repository: "your-acr.azurecr.io/stackai/celery-worker"
    tag: "v1.0.0"
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: 512Mi
      cpu: 300m
    limits:
      memory: 1Gi
      cpu: 1000m
  env:
    CELERY_BROKER_URL: "redis://celery-broker:6379/0"
    CELERY_RESULT_BACKEND: "redis://celery-broker:6379/0"
    secrets:
      useExternalSecrets: true
      externalSecretName: "celery-secrets"

externalSecrets:
  enabled: true
  secretStore:
    name: "azure-keyvault-store"
    class: "azure-keyvault"
    vaultUrl: "https://your-keyvault.vault.azure.net/"
    tenantId: "your-tenant-id"
    servicePrincipal:
      clientId: "your-client-id"
      clientSecretRef:
        name: "azure-keyvault-credentials"
        key: "client-secret"
